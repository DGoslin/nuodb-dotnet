<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Fragment>
    <PropertyRef Id="NETFRAMEWORK20INSTALLROOTDIR"/>
    <PropertyRef Id="NETFRAMEWORK40CLIENTINSTALLROOTDIR"/>
    <PropertyRef Id="NETFRAMEWORK20INSTALLROOTDIR64"/>
    <PropertyRef Id="NETFRAMEWORK40CLIENTINSTALLROOTDIR64"/>

    <Property Id="EXTENSION_DIR_VS2010">
      <RegistrySearch Id="VS2010_Extension"
                      Root="HKCU"
                      Key="Software\Microsoft\VisualStudio\10.0_Config\Initialization"
                      Name="ApplicationExtensionsFolder"
                      Type="raw" />
    </Property>
    <SetProperty Id="NUODB_EXTENSION_DIR_VS2010" Value="[EXTENSION_DIR_VS2010]\NuoDB" After="AppSearch">EXTENSION_DIR_VS2010</SetProperty>

    <Property Id="EXTENSION_DIR_VS2012">
      <RegistrySearch Id="VS2012_Extension"
                      Root="HKCU"
                      Key="Software\Microsoft\VisualStudio\11.0_Config\Initialization"
                      Name="ApplicationExtensionsFolder"
                      Type="raw" />
    </Property>
    <SetProperty Id="NUODB_EXTENSION_DIR_VS2012" Value="[EXTENSION_DIR_VS2012]\NuoDB" After="AppSearch">EXTENSION_DIR_VS2012</SetProperty>

    <DirectoryRef Id="INSTALLFOLDER">
      <Component Id="Install_DotNetDriver" Guid="A04B6218-AD90-40E5-8001-918CF0D3EAF2">
        <File Id="NuoDb.Data.Client.dll"
              KeyPath="yes"
              Source="../NuoDb.Data.Client/bin/$(var.Configuration)/NuoDb.Data.Client.dll"/>
        <RegistryValue Id="R_DT_AssemblyFolders"
                        Root="HKLM"
                        Key="SOFTWARE\Microsoft\.NETFramework\AssemblyFolders\[ProductName]"
                        Value="[$Install_DotNetDriver]"
                        Type="string"/>
      </Component>

      <Directory Id="EXTENSION_DIR_VS2010" Name="VS2010">
        <Directory Id="NUODB_EXTENSION_DIR_VS2010" Name="NuoDB" >
          <Directory Id="VS2010_Templates" Name="Templates" />
        </Directory>
        <Directory Id="EXTENSION_DIR_VS2010_MICROSOFT" Name="Microsoft" >
          <Directory Id="EXTENSION_DIR_VS2010_MICROSOFT_EFT" Name="Entity Framework Tools">
            <Directory Id="EXTENSION_DIR_VS2010_MICROSOFT_EFT_DBGEN" Name="DBGen"/>
            <Directory Id="EXTENSION_DIR_VS2010_MICROSOFT_EFT_TEMPLATES" Name="Templates">
              <Directory Id="EXTENSION_DIR_VS2010_MICROSOFT_EFT_TEMPLATES_INCLUDES" Name="Includes"/>
            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="EXTENSION_DIR_VS2012" Name="VS2012">
        <Directory Id="NUODB_EXTENSION_DIR_VS2012" Name="NuoDB" >
          <Directory Id="VS2012_Templates" Name="Templates" />
        </Directory>
        <Directory Id="EXTENSION_DIR_VS2012_MICROSOFT" Name="Microsoft" >
          <Directory Id="EXTENSION_DIR_VS2012_MICROSOFT_EFT" Name="Entity Framework Tools">
            <Directory Id="EXTENSION_DIR_VS2012_MICROSOFT_EFT_DBGEN" Name="DBGen"/>
            <Directory Id="EXTENSION_DIR_VS2012_MICROSOFT_EFT_TEMPLATES" Name="Templates">
              <Directory Id="EXTENSION_DIR_VS2012_MICROSOFT_EFT_TEMPLATES_INCLUDES" Name="Includes"/>
            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="GAC" Name="GAC">
        <Component Id="Register_DotNetDriver" Guid="36FCC7E2-FCC8-431B-8C94-EB9E92B84CE6">
          <File Id="NuoDb.Data.Client.dll_GAC"
                Name="NuoDb.Data.Client.dll"
                Assembly=".net"
                KeyPath="yes"
                Source="../NuoDb.Data.Client/bin/$(var.Configuration)/NuoDb.Data.Client.dll"/>

          <!-- .NET 4.0 -->
          <util:XmlConfig Id="MachineConfigDbProviderFactories40"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR]Config\machine.Config"
                      Action="create"
                      On="install"
                      ElementPath="//configuration/system.data/DbProviderFactories"
                      Name="add"
                      Node="element"
                      Sequence="1" />

          <util:XmlConfig Id="MachineConfigDbProviderFactories_Name40"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories40"
                      Name="name"
                      Value="NuoDB Data Provider"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Invariant40"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories40"
                      Name="invariant"
                      Value="NuoDb.Data.Client"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Description40"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories40"
                      Name="description"
                      Value=".NET Framework Data Provider for NuoDB"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Type40"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories40"
                      Name="type"
                      Value="NuoDb.Data.Client.NuoDbProviderFactory, NuoDb.Data.Client, Version=!(bind.FileVersion.NuoDb.Data.Client.dll), Culture=neutral, PublicKeyToken=e49f105b7fb49b38"
                      Sequence="2" />

          <util:XmlConfig Id="MachineConfigDbProviderFactories_Uninstall40"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR]Config\machine.Config"
                      Action="delete"
                      On="uninstall"
                      Node="element"
                      VerifyPath="add[\[]@invariant='NuoDb.Data.Client'[\]]"
                      ElementPath="//configuration/system.data/DbProviderFactories"
                      Sequence="1" />


          <!-- .NET 2.0 - 3.5 -->
          <util:XmlConfig Id="MachineConfigDbProviderFactories20"
                      File="[NETFRAMEWORK20INSTALLROOTDIR]Config\machine.Config"
                      Action="create"
                      On="install"
                      ElementPath="//configuration/system.data/DbProviderFactories"
                      Name="add"
                      Node="element"
                      Sequence="1" />

          <util:XmlConfig Id="MachineConfigDbProviderFactories_Name20"
                      File="[NETFRAMEWORK20INSTALLROOTDIR]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories20"
                      Name="name"
                      Value="NuoDB Data Provider"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Invariant20"
                      File="[NETFRAMEWORK20INSTALLROOTDIR]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories20"
                      Name="invariant"
                      Value="NuoDb.Data.Client"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Description20"
                      File="[NETFRAMEWORK20INSTALLROOTDIR]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories20"
                      Name="description"
                      Value=".NET Framework Data Provider for NuoDB"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Type20"
                      File="[NETFRAMEWORK20INSTALLROOTDIR]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories20"
                      Name="type"
                      Value="NuoDb.Data.Client.NuoDbProviderFactory, NuoDb.Data.Client, Version=!(bind.FileVersion.NuoDb.Data.Client.dll), Culture=neutral, PublicKeyToken=e49f105b7fb49b38"
                      Sequence="2" />

          <util:XmlConfig Id="MachineConfigDbProviderFactories_Uninstall20"
                      File="[NETFRAMEWORK20INSTALLROOTDIR]Config\machine.Config"
                      Action="delete"
                      On="uninstall"
                      Node="element"
                      VerifyPath="add[\[]@invariant='NuoDb.Data.Client'[\]]"
                      ElementPath="//configuration/system.data/DbProviderFactories"
                      Sequence="1" />

          <!-- .NET 4.0 64 bit-->
          <util:XmlConfig Id="MachineConfigDbProviderFactories40_x64"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR64]Config\machine.Config"
                      Action="create"
                      On="install"
                      ElementPath="//configuration/system.data/DbProviderFactories"
                      Name="add"
                      Node="element"
                      Sequence="1" />

          <util:XmlConfig Id="MachineConfigDbProviderFactories_Name40_x64"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR64]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories40_x64"
                      Name="name"
                      Value="NuoDB Data Provider"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Invariant40_x64"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR64]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories40_x64"
                      Name="invariant"
                      Value="NuoDb.Data.Client"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Description40_x64"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR64]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories40_x64"
                      Name="description"
                      Value=".NET Framework Data Provider for NuoDB"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Type40_x64"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR64]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories40_x64"
                      Name="type"
                      Value="NuoDb.Data.Client.NuoDbProviderFactory, NuoDb.Data.Client, Version=!(bind.FileVersion.NuoDb.Data.Client.dll), Culture=neutral, PublicKeyToken=e49f105b7fb49b38"
                      Sequence="2" />

          <util:XmlConfig Id="MachineConfigDbProviderFactories_Uninstall40_x64"
                      File="[NETFRAMEWORK40CLIENTINSTALLROOTDIR64]Config\machine.Config"
                      Action="delete"
                      On="uninstall"
                      Node="element"
                      VerifyPath="add[\[]@invariant='NuoDb.Data.Client'[\]]"
                      ElementPath="//configuration/system.data/DbProviderFactories"
                      Sequence="1" />


          <!-- .NET 2.0 - 3.5 64 it-->
          <util:XmlConfig Id="MachineConfigDbProviderFactories20_x64"
                      File="[NETFRAMEWORK20INSTALLROOTDIR64]Config\machine.Config"
                      Action="create"
                      On="install"
                      ElementPath="//configuration/system.data/DbProviderFactories"
                      Name="add"
                      Node="element"
                      Sequence="1" />

          <util:XmlConfig Id="MachineConfigDbProviderFactories_Name20_x64"
                      File="[NETFRAMEWORK20INSTALLROOTDIR64]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories20_x64"
                      Name="name"
                      Value="NuoDB Data Provider"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Invariant20_x64"
                      File="[NETFRAMEWORK20INSTALLROOTDIR64]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories20_x64"
                      Name="invariant"
                      Value="NuoDb.Data.Client"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Description20_x64"
                      File="[NETFRAMEWORK20INSTALLROOTDIR64]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories20_x64"
                      Name="description"
                      Value=".NET Framework Data Provider for NuoDB"
                      Sequence="2" />
          <util:XmlConfig Id="MachineConfigDbProviderFactories_Type20_x64"
                      File="[NETFRAMEWORK20INSTALLROOTDIR64]Config\machine.Config"
                      ElementPath="MachineConfigDbProviderFactories20_x64"
                      Name="type"
                      Value="NuoDb.Data.Client.NuoDbProviderFactory, NuoDb.Data.Client, Version=!(bind.FileVersion.NuoDb.Data.Client.dll), Culture=neutral, PublicKeyToken=e49f105b7fb49b38"
                      Sequence="2" />

          <util:XmlConfig Id="MachineConfigDbProviderFactories_Uninstall20_x64"
                      File="[NETFRAMEWORK20INSTALLROOTDIR64]Config\machine.Config"
                      Action="delete"
                      On="uninstall"
                      Node="element"
                      VerifyPath="add[\[]@invariant='NuoDb.Data.Client'[\]]"
                      ElementPath="//configuration/system.data/DbProviderFactories"
                      Sequence="1" />
        </Component>
      </Directory>
    </DirectoryRef>

    <Component Guid="EE2D9D51-67B3-45D3-B7C0-1EA45DCCB59A" Id="ForceVStudioRefresh" Directory="TARGETDIR">
      <RegistryValue KeyPath="yes" Action="write" Root="HKCU" Key="SOFTWARE\NuoDB" Name="Installed" Type="integer" Value="0"/>
      <RemoveRegistryKey Id="ForceRefreshOnInstall_VS2010" Action="removeOnInstall" Root="HKCU" Key="SOFTWARE\Microsoft\VisualStudio\10.0_Config"/>
      <RemoveRegistryKey Id="ForceRefreshOnUninstall_VS2010"  Action="removeOnUninstall" Root="HKCU" Key="SOFTWARE\Microsoft\VisualStudio\10.0_Config"/>
      <RemoveRegistryKey Id="ForceRefreshOnInstall_VS2012" Action="removeOnInstall" Root="HKCU" Key="SOFTWARE\Microsoft\VisualStudio\11.0_Config"/>
      <RemoveRegistryKey Id="ForceRefreshOnUninstall_VS2012"  Action="removeOnUninstall" Root="HKCU" Key="SOFTWARE\Microsoft\VisualStudio\11.0_Config"/>
    </Component>

    <ComponentGroup Id="Install_DDEXPlugin_VS2010">
      <Component Guid="A04B6218-AD90-40E5-8001-918CF0D3EAF3" Directory="NUODB_EXTENSION_DIR_VS2010">
        <File KeyPath="yes" Id="NuoDb.VisualStudio.DataTools.pkgdef_VS2010"
              Source="../NuoDBVSPackage/bin/$(var.Configuration)/NuoDb.VisualStudio.DataTools.pkgdef">
        </File>
        <File Id="NuoDb.VisualStudio.DataTools.dll_VS2010"
              Source="../NuoDBVSPackage/bin/$(var.Configuration)/NuoDb.VisualStudio.DataTools.dll">
        </File>
        <File Id="extension.vsixmanifest_VS2010"
              Source="../NuoDBVSPackage/bin/$(var.Configuration)/extension.vsixmanifest">
        </File>
      </Component>
      <Component Guid="A04B6218-AD90-40E5-8001-918CF0D3EAF4" Directory="VS2010_Templates">
        <File KeyPath="yes" Id="NewQuery.nuosql_VS2010"
              Source="../NuoDBVSPackage/Templates/New Query.nuosql">
        </File>
        <File Id="NuoDBVSPackage.vsdir_VS2010"
              Source="../NuoDBVSPackage/Templates/NuoDBVSPackage.vsdir">
        </File>
      </Component>
      <Component Guid="A04B6218-AD90-40E5-8001-918CF0D3EAF5" Directory="EXTENSION_DIR_VS2010_MICROSOFT_EFT_DBGEN">
        <File KeyPath="yes" Id="SSDLToNuoSQL.tt_VS2010"
              Name="SSDLToNuoSQL.tt"
              Source="../NuoDBVSPackage/Templates/DDL_Templates/SSDLToNuoSQL.tt.txt">
        </File>
      </Component>
      <Component Guid="A04B6218-AD90-40E5-8001-918CF0D3EAF6" Directory="EXTENSION_DIR_VS2010_MICROSOFT_EFT_TEMPLATES_INCLUDES">
        <File KeyPath="yes" Id="GenerateNuoSQL.Utility.ttinclude_VS2010"
              Name="GenerateNuoSQL.Utility.ttinclude"
              Source="../NuoDBVSPackage/Templates/DDL_Templates/GenerateNuoSQL.Utility.ttinclude.txt">
        </File>
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="Install_DDEXPlugin_VS2012">
      <Component Guid="0FAF282B-FA33-4F1E-88BC-BD50C19F0B28" Directory="NUODB_EXTENSION_DIR_VS2012">
        <File KeyPath="yes" Id="NuoDb.VisualStudio.DataTools.pkgdef_VS2012"
              Source="../NuoDBVSPackage/bin/$(var.Configuration)/NuoDb.VisualStudio.DataTools.pkgdef">
        </File>
        <File Id="NuoDb.VisualStudio.DataTools.dll_VS2012"
              Source="../NuoDBVSPackage/bin/$(var.Configuration)/NuoDb.VisualStudio.DataTools.dll">
        </File>
        <File Id="extension.vsixmanifest_VS2012"
              Source="../NuoDBVSPackage/bin/$(var.Configuration)/extension.vsixmanifest">
        </File>
      </Component>
      <Component Guid="0FAF282B-FA33-4F1E-88BC-BD50C19F0B29" Directory="VS2012_Templates">
        <File KeyPath="yes" Id="NewQuery.nuosql_VS2012"
              Source="../NuoDBVSPackage/Templates/New Query.nuosql">
        </File>
        <File Id="NuoDBVSPackage.vsdir_VS2012"
              Source="../NuoDBVSPackage/Templates/NuoDBVSPackage.vsdir">
        </File>
      </Component>
      <Component Guid="A04B6218-AD90-40E5-8001-918CF0D3EAF7" Directory="EXTENSION_DIR_VS2012_MICROSOFT_EFT_DBGEN">
        <File KeyPath="yes" Id="SSDLToNuoSQL.tt_VS2012"
              Name="SSDLToNuoSQL.tt"
              Source="../NuoDBVSPackage/Templates/DDL_Templates/SSDLToNuoSQL.tt.txt">
        </File>
      </Component>
      <Component Guid="A04B6218-AD90-40E5-8001-918CF0D3EAF8" Directory="EXTENSION_DIR_VS2012_MICROSOFT_EFT_TEMPLATES_INCLUDES">
        <File KeyPath="yes" Id="GenerateNuoSQL.Utility.ttinclude_VS2012"
              Name="GenerateNuoSQL.Utility.ttinclude"
              Source="../NuoDBVSPackage/Templates/DDL_Templates/GenerateNuoSQL.Utility.ttinclude.txt">
        </File>
      </Component>
    </ComponentGroup>

  </Fragment>

</Wix>